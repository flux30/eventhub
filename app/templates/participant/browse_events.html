{% extends "base.html" %}
{% block title %}Browse Events - EventHub{% endblock %}
{% block content %}

<div class="browse-container">
    <div class="browse-header">
        <div>
            <h1>Discover Events</h1>
            <p>Find your next amazing experience</p>
        </div>
    </div>

    <!-- Filters -->
    <form method="GET" class="filters-bar">
        <div class="search-wrap">
            <i class="fas fa-search search-icon"></i>
            <input type="text" name="q" placeholder="Search events..."
                   value="{{ search_query or '' }}" class="filter-input search-input">
        </div>
        <select name="category" class="filter-input filter-select">
            <option value="">All Categories</option>
            {% for cat in categories %}
                <option value="{{ cat }}" {% if selected_category == cat %}selected{% endif %}>
                    {{ cat|title }}
                </option>
            {% endfor %}
        </select>
        <button type="submit" class="filter-btn">
            <i class="fas fa-filter"></i> Filter
        </button>
        {% if search_query or selected_category %}
        <a href="{{ url_for('participant.browse_events') }}" class="clear-btn">
            <i class="fas fa-times"></i> Clear
        </a>
        {% endif %}
    </form>

    <!-- Results count -->
    {% if events %}
    <p class="results-count">{{ events|length }} event{{ 's' if events|length != 1 }} found</p>
    {% endif %}

    <!-- Events Grid -->
    {% if events %}
    <div class="events-grid">
        {% for event in events %}
        <div class="event-card">
            <!-- Banner -->
            <div class="event-banner">
                {% if event.image %}
                    <div class="banner-bg"
                         style="background-image:url('{{ url_for('static', filename='uploads/events/' + event.image) }}')">
                    </div>
                    <img src="{{ url_for('static', filename='uploads/events/' + event.image) }}"
                         alt="{{ event.title }}" class="banner-img">
                {% else %}
                    <div class="banner-placeholder"></div>
                {% endif %}
                <span class="cat-pill">{{ event.category|title }}</span>
                {% if event.is_paid %}
                    <span class="price-pill">â‚¹{{ event.price|round|int }}</span>
                {% else %}
                    <span class="price-pill free-pill">Free</span>
                {% endif %}
            </div>

            <!-- Body -->
            <div class="card-body">
                <h3 class="card-title">{{ event.title }}</h3>
                <div class="card-meta">
                    <div class="meta-row">
                        <i class="fas fa-calendar"></i>
                        <span>{{ event.event_date.strftime('%d %b %Y') }}</span>
                        <i class="fas fa-clock" style="margin-left:12px"></i>
                        <span>{{ event.event_date.strftime('%I:%M %p') }}</span>
                    </div>
                    <div class="meta-row">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>{{ event.location[:40] }}{% if event.location|length > 40 %}...{% endif %}</span>
                    </div>
                    <div class="meta-row">
                        <i class="fas fa-users"></i>
                        <span class="{% if (event.available_seats or 0) < 10 %}seats-low{% endif %}">
                            {{ event.available_seats or 0 }} seats left
                        </span>
                    </div>
                </div>
                <a href="{{ url_for('participant.event_details', event_id=event.id) }}"
                   class="view-btn">
                    View Details <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-search"></i>
        <h3>No events found</h3>
        <p>Try adjusting your search or filters</p>
        {% if search_query or selected_category %}
        <a href="{{ url_for('participant.browse_events') }}" class="view-btn" style="display:inline-flex;width:auto;margin-top:16px">
            Clear Filters
        </a>
        {% endif %}
    </div>
    {% endif %}
</div>

<style>
*, *::before, *::after { box-sizing: border-box; }

.browse-container { max-width: 1200px; margin: 0 auto; padding: 32px 20px; }

.browse-header { margin-bottom: 28px; }
.browse-header h1 { font-size: 32px; font-weight: 800; margin: 0 0 6px 0; }
.browse-header p  { color: var(--text-secondary); margin: 0; }

/* Filters */
.filters-bar {
    display: flex; align-items: center; gap: 12px;
    background: var(--bg-elevated); border-radius: 14px;
    padding: 16px 20px; margin-bottom: 24px;
    border: 1px solid rgba(255,255,255,0.06); flex-wrap: wrap;
}
.search-wrap { position: relative; flex: 1; min-width: 200px; }
.search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary); }
.filter-input {
    width: 100%; padding: 10px 14px; background: var(--bg-base);
    border: 1px solid rgba(255,255,255,0.08); border-radius: 8px;
    font-size: 14px; color: var(--text-primary); font-family: inherit;
}
.filter-input:focus { outline: none; border-color: var(--accent); }
.search-input { padding-left: 38px; }
.filter-select { width: 180px; min-width: 140px; cursor: pointer; }
.filter-btn {
    padding: 10px 20px; background: var(--accent); color: white;
    border: none; border-radius: 8px; font-size: 14px; font-weight: 600;
    cursor: pointer; display: flex; align-items: center; gap: 8px; white-space: nowrap;
}
.filter-btn:hover { opacity: 0.9; }
.clear-btn {
    padding: 10px 16px; background: transparent; color: var(--text-secondary);
    border: 1px solid rgba(255,255,255,0.1); border-radius: 8px;
    font-size: 14px; font-weight: 500; text-decoration: none;
    display: flex; align-items: center; gap: 6px; white-space: nowrap;
}
.clear-btn:hover { border-color: #ef4444; color: #ef4444; }

.results-count { font-size: 14px; color: var(--text-secondary); margin-bottom: 20px; }

/* Events Grid */
.events-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 24px;
}

/* Event Card */
.event-card {
    background: var(--bg-elevated);
    border-radius: 16px; overflow: hidden;
    border: 1px solid rgba(255,255,255,0.05);
    transition: transform 0.2s, box-shadow 0.2s;
    display: flex; flex-direction: column;
}
.event-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 16px 40px rgba(0,0,0,0.4);
    border-color: rgba(77,166,255,0.15);
}

/* Banner with blurred backdrop */
.event-banner {
    position: relative; height: 220px;
    overflow: hidden; background: #0a0f1a;
    display: flex; align-items: center; justify-content: center;
}
.banner-bg {
    position: absolute; inset: -10px;
    background-size: cover; background-position: center;
    filter: blur(16px) brightness(0.35);
    transform: scale(1.15); z-index: 0;
}
.banner-img {
    position: relative; z-index: 1;
    max-width: 100%; max-height: 100%;
    width: auto; height: auto;
    object-fit: contain; display: block;
}
.banner-placeholder {
    width: 100%; height: 100%;
    background: linear-gradient(135deg, #1a1040, #0d2340);
}
.cat-pill {
    position: absolute; top: 12px; left: 12px; z-index: 2;
    background: rgba(0,0,0,0.6); backdrop-filter: blur(8px);
    color: white; padding: 4px 12px; border-radius: 20px;
    font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;
}
.price-pill {
    position: absolute; top: 12px; right: 12px; z-index: 2;
    background: rgba(168,85,247,0.8); backdrop-filter: blur(8px);
    color: white; padding: 4px 12px; border-radius: 20px;
    font-size: 11px; font-weight: 700;
}
.free-pill { background: rgba(16,185,129,0.8); }

/* Card Body */
.card-body { padding: 20px; display: flex; flex-direction: column; flex: 1; }
.card-title {
    font-size: 16px; font-weight: 700; margin: 0 0 14px 0;
    line-height: 1.4; color: var(--text-primary);
    display: -webkit-box; -webkit-line-clamp: 2;
    -webkit-box-orient: vertical; overflow: hidden;
}
.card-meta { display: flex; flex-direction: column; gap: 8px; margin-bottom: 18px; flex: 1; }
.meta-row {
    display: flex; align-items: center; gap: 8px;
    font-size: 13px; color: var(--text-secondary);
}
.meta-row i { color: var(--accent); width: 14px; font-size: 12px; flex-shrink: 0; }
.seats-low { color: #ef4444; font-weight: 600; }

.view-btn {
    display: flex; align-items: center; justify-content: center; gap: 8px;
    width: 100%; padding: 11px 16px; background: var(--accent); color: white;
    border-radius: 10px; font-size: 14px; font-weight: 700;
    text-decoration: none; transition: all 0.2s; border: none; cursor: pointer;
    margin-top: auto;
}
.view-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(77,166,255,0.4); }

/* Empty state */
.empty-state { text-align: center; padding: 80px 20px; }
.empty-state i { font-size: 56px; color: var(--text-tertiary); opacity: 0.3; display: block; margin-bottom: 20px; }
.empty-state h3 { font-size: 22px; font-weight: 700; margin: 0 0 8px 0; }
.empty-state p  { color: var(--text-secondary); margin: 0; }

@media (max-width: 768px) {
    .filters-bar { flex-direction: column; align-items: stretch; }
    .filter-select, .search-wrap { width: 100%; }
    .events-grid { grid-template-columns: 1fr; }
}
</style>
{% endblock %}
